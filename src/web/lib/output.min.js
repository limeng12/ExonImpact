function cumulativeOffset(t){var i=0,e=0;do i+=t.offsetTop||0,e+=t.offsetLeft||0,t=t.offsetParent;while(t);return{top:i,left:e}}function getOffset(t){if(void 0!=t.offsetX)return{x:t.offsetX,y:t.offsetY};for(var i=t.target,e={x:0,y:0};i.offsetParent;)e.x+=i.offsetLeft,e.y+=i.offsetTop,i=i.offsetParent;return e.x=t.pageX-e.x,e.y=t.pageY-e.y,e}function getBrowserName(){var t=navigator.appName,i=navigator.userAgent;return-1!=(verOffset=i.indexOf("Opera"))?t="Opera":-1!=(verOffset=i.indexOf("MSIE"))?t="Microsoft Internet Explorer":-1!=(verOffset=i.indexOf("Chrome"))?t="Chrome":-1!=(verOffset=i.indexOf("Safari"))?t="Safari":-1!=(verOffset=i.indexOf("Firefox"))&&(t="Firefox"),t}function submitQueryEvent(t){return!0}function leftPanelButtonOver(){document.images.leftPanelButton.src="lib/xl.jpg";var t=document.getElementById("leftPanelControl");t.style.display="block"}function validatFrom(){return!1}function leftPanelButtonOut(){document.images.leftPanelButton.src="lib/xx.jpg";var t=document.getElementById("leftPanelControl");t.style.display="none"}function leftPanelExpand(){}function checkBox(t){var i=t.checked,e=t.value;if("GenePart"==e){var n=document.getElementById("geneVisualModule");i?n.style.display="block":n.style.display="none"}if("proteinPart"==e){var n=document.getElementById("proteinVisualModule1");i?n.style.display="block":n.style.display="none"}if("transcriptPart"==e){var n=document.getElementById("transcriptsVisualModule");i?n.style.display="block":n.style.display="none"}}function validate_form(t){var i="chr\\w+:(\\d+):(\\d+):(\\+|-)@chr\\w+:(\\d+):(\\d+):(\\+|-)@chr\\w+:(\\d+):(\\d+):(\\+|-)",e="chr\\w+:(\\d+):(\\d+)\\|(\\d+):(\\+|-)@chr(\\w+):(\\d+):(\\d+):(\\+|-)",n="chr(\\w+):(\\d+):(\\d+):(\\+|-)@chr\\w+:(\\d+)\\|(\\d+):(\\d+):(\\+|-)",o="chr(\\w+):(\\d+)-(\\d+):(\\+|-)@chr(\\w+):(\\d+)-(\\d+):(\\+|-)",s="^ENST",r="^uc",h="^NM",l="(@chr\\w+:(\\d+):(\\d+):(\\+-)((:Splice)*))+",a=document.getElementById("searchFild"),c=a.value,u=new RegExp(i),d=new RegExp(e),f=new RegExp(n),p=new RegExp(o),P=new RegExp(s),m=new RegExp(r),v=new RegExp(h),v=new RegExp(l),g=u.test(c);if(g=d.test(c)||g,g=f.test(c)||g,g=p.test(c)||g,g=P.test(c)||g,g=m.test(c)||g,g=v.test(c)||g,0==g)return alert("Your input format is not right."),!1;var y=document.getElementById("searchFild"),c=y.value;document.cookie="eventId="+c;var x=document.getElementById("submitQuery"),S=cumulativeOffset(x).left,W=cumulativeOffset(x).top;x.style.display="none";var A=document.getElementById("loadingGif");return A.style.display="block",A.style.position="absolute",A.style.left=S+"px",A.style.top=W-50+"px",!0}function initFirstPage(){}function initVisualPage(t){var i=document.getElementById("mainPage");i.style.width=document.documentElement.clientWidth-12+"px";var e=document.documentElement.clientWidth-20,n=document.getElementById("geneVisual");if("undefined"!=typeof n&&null!=n){n.width=e;var o=document.getElementById("proteinVisual1");o.width=e;var s=document.getElementById("transcriptsVisual");s.width=e;var r=new ASPlot.visualPage(t+".xml");r.genePlot.plot(),null!=r.proteinPlot1&&r.proteinPlot1.plot(),null!=r.transcriptPlot&&r.transcriptPlot.plot()}}function browser_init(t){window.addEventListener;navigator.userAgent.toLowerCase();initFirstPage(),initVisualPage(t)}var ASPlot={};ASPlot.Utility=function(){},ASPlot.Utility.prototype.plotStrand=function(t,i,e,n,o,s){0!=i&&(t.font="13px monospace",t.fillText(o,0,n+15)),t.fillText(s,e/2,n+15)},ASPlot.Utility.prototype.continuousValuePlot=function(t,i,e,n,o,s,r,h){t.fillStyle="#000000",t.fillStyle="#000000",t.font="10px monospace",0!=r&&(t.font="13px monospace",t.fillText(h,0,s+15));for(var l=0;l<i.length;++l)i[l]=parseFloat(i[l]),e>l+1||l+1>n||t.fillRect(r+(1+l-e)*o,s+15*(1-i[l]),14,15*i[l])},ASPlot.Utility.prototype.alphabetPlot=function(t,i,e,n,o,s,r,h){0!=r&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(h,0,s+15)),t.fillStyle="#000000",t.font="10px monospace",t.font=200/114*o+"px monospace";for(var l=0,a=0;n-e>a&&!(a>i.length-1);++a)t.fillText(i[a],r+l,s+15),l+=o},ASPlot.Utility.prototype.alphabetPlotColorTable=function(t,i,e,n,o,s,r,h){0!=r&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(h,0,s+15)),t.fillStyle="#000000",t.font="10px monospace",t.font=200/114*o+"px monospace";for(var l=0,a=0;n-e>a&&!(a>i.length-1);++a)"b"==i[a]?t.fillStyle="#FA8072":"n"==i[a]?t.fillStyle="#8470FF":"g"==i[a]?t.fillStyle="#DAA520":"p"==i[a]?t.fillStyle="#98FB98":"a"==i[a]?t.fillStyle="#00FFFF":t.fillStyle="#ffffff",t.fillRect(r+l,s,o,28),t.fillStyle="#000000",t.fillText(i[a],r+l,s+22),l+=o},ASPlot.Utility.prototype.coordinatePlotAS=function(t,i,e,n,o,s,r,h,l,a,c){0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,h+15)),t.fillStyle="#000000",t.strokeStyle="#000000",t.lineWidth=2,t.font="10px monospace";var u=e,d=n,f=0,p=100;r>=5&&(p=100-100%r,console.log(p+" "+r));for(var P=0;P<Math.round(d-u);){var m=0;t.moveTo(a+(P+f)*r,h+5),t.lineTo(a+(P+f)*r,h+15);var v=parseInt(t.measureText(Math.round(u+P+f)).width);if(a+Math.round(P+f)*r+parseFloat(v)-o>0)break;for(var g=Math.round(u+P+f),y=0;y<i.length&&!(g<i[y].begPos);++y)m+=g>i[y].endPos?i[y].endPos-i[y].begPos:g-i[y].begPos;g+="("+(g-parseInt(m))+")",t.fillText(g,a+Math.round(P+f)*r,h),P+=p/r}t.moveTo(a+0,h+15),t.lineTo(o,h+15)},ASPlot.Utility.prototype.coordinatePlot=function(t,i,e,n,o,s,r,h,l,a,c){0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,h+15)),t.fillStyle="#000000",t.strokeStyle="#000000",t.lineWidth=2,t.font="10px monospace";var u=e,d=n,f=100;r>=5&&(f=100-100%r,console.log(f+" "+r));for(var p=0,P=0;P<Math.round(d-u);){t.moveTo(a+(P+p)*r,h+5),t.lineTo(a+(P+p)*r,h+15);var m=parseInt(t.measureText(Math.round(u+P+p)).width);if(a+Math.round(P+p)*r+parseFloat(m)-o>0)break;t.fillText(Math.round(u+P+p),a+Math.round(P+p)*r,h),P+=f/r}t.moveTo(a+0,h+15),t.lineTo(o,h+15)},ASPlot.Utility.prototype.blocksPlotPipeLine=function(t,i,e,n,o,s,r,h,l,a,c){var u=h;t.fillStyle="#000000",t.font="12px monospace",("undefined"==typeof l||null==l)&&(l="#800000"),("undefined"==typeof h||null==h)&&(s=40),t.fillStyle=l;var d=0;for(var f in i){var p=i[f].begPos;if(!(p>n)){var P=p>e?p:e,m=i[f].endPos;if(!(e>m)){var v=m-P+1;t.fillStyle=l,t.fillRect(a+(P-e)*r,h,v*r,s);var g=i[f].description;t.fillStyle="#000000",t.fillText(g,a+(P-e)*r,h+s-4),0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,u+15)),d=1}}}return d*(s+10)},ASPlot.Utility.prototype.blocksPlot=function(t,i,e,n,o,s,r,h,l,a,c){0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,h+15)),t.fillStyle="#000000",("undefined"==typeof l||null==l)&&(l="#800000"),("undefined"==typeof h||null==h)&&(s=20),t.fillStyle=l;for(var u in i){var d=i[u].begPos;if(!(d>n)){var f=d>e?d:e,p=i[u].endPos;if(!(e>p)){var P=p-f+1;t.fillRect(a+(f-e)*r,h,P*r,s)}}}},ASPlot.Utility.prototype.blocksPlotWithLine=function(t,i,e,n,o,s,r,h,l){("undefined"==typeof l||null==l)&&(l="#800000"),("undefined"==typeof h||null==h)&&(s=20),t.fillStyle=l,t.strokeStyle="#000000",t.lineWidth=2;var a=-1,c=-1,u=-1;for(var d in i){var f=i[d].begPos,a=f>e?f:e,c=e>c?e:c;t.moveTo((c-e)*r,h+s/2),t.lineTo((c-e+(a-c)/2)*r,h),t.moveTo((c-e+(a-c)/2)*r,h),t.lineTo((a-e)*r,h+s/2);var c=i[d].endPos;if(!(f>n||e>c)){var u=c-a+1;t.fillRect((a-e)*r,h,u*r,s)}}},ASPlot.Utility.prototype.blocksPlotWithLineAS=function(t,i,e,n,o,s,r,h,l,a,c){0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,h+15)),t.fillStyle="#000000",t.font="10px monospace",("undefined"==typeof l||null==l)&&(l="#800000"),("undefined"==typeof h||null==h)&&(s=20);var u=-1,d=-1,f=-1;t.strokeStyle="#000000",t.lineWidth=2;for(var p in i){t.fillStyle=l;var P=i[p].ifAS,m=i[p].begPos,u=m>e?m:e,d=e>d?e:d;0!=p&&(o>a+(d-e+1)*r&&(t.moveTo(a+(d-e+1)*r,h+s/2),a+(d-e+(u-d)/2)*r>o?t.lineTo(o,h):t.lineTo(a+(d-e+(u-d)/2)*r,h)),o>a+(d-e+(u-d)/2)*r&&(t.moveTo(a+(d-e+(u-d)/2)*r,h),a+(u-e)*r>o?t.lineTo(o,h+s/2):t.lineTo(a+(u-e)*r,h+s/2)));var d=i[p].endPos;if(!(m>n||e>d)){var f=d-u+1;P?t.fillStyle="#FA8072":t.fillStyle="#800000",t.fillRect(a+(u-e)*r,h,f*r,s)}}},ASPlot.visualPage=function(t){if("undefined"!=typeof t&&null!=t&&""!=t){var i=new ASPlot.xmlParser;this.plotEngine=new ASPlot.Utility,this.xml=i.parseXML(t),this.genePlot=new ASPlot.GenePlot(i,this.plotEngine),this.isoforms=i.parseIsoforms();this.leftFont="10px monospace",null!=this.isoforms[0]&&(this.proteinPlot1=new ASPlot.ProteinPlot("proteinVisual1",this.isoforms[0],this.isoforms[1],i,this.plotEngine,!1)),this.transcriptPlot=new ASPlot.transcriptPlot(i,this.plotEngine)}},ASPlot.visualPage.prototype.setIfPlotLeft=function(t){this.genePlot.plotLeft=t,this.proteinPlot1.plotLeft=t},ASPlot.ProteinPlot=function(t,i,e,n,o,s){if("undefined"!=typeof t&&null!=t&&""!=t){this.plotLeft=!0,this.leftWidth=120,this.isoform1=i,this.isoform2=e,this.strand=n.getStrand(),this.proteinLength=i.proteinSequence.length,this.start=1,this.end=this.proteinLength,this.plotEngine=o,this.canvasProtein=document.getElementById(t),this.contextProtein=this.canvasProtein.getContext("2d"),this.canvasProteinWidth=this.canvasProtein.width,this.currentPosition=0,this.x=-1,this.y=-1,this.mouseIsDown=!1,this.moveWidth=10,this.coordinatePosition=-1,this.ifASOut=s,this.browserName=getBrowserName(),this.unitWidth=11,this.maxUnitWidth=15,this.minUnitWidth=1,this.minFontWidth=7,this.imgData,this.moveLastX=-1,this.moveLastY=-1,this.geneStrucBlocks=n.parseTranscript(),this.currentPosition=this.start,this.residue=0;var r=this;if(this.alternativeSplicingRegions=[],this.canvasProtein.addEventListener("mouseup",function(t){r.mouseUp(t)},!1),this.canvasProtein.addEventListener("mousedown",function(t){r.mouseDown(t)},!1),this.canvasProtein.addEventListener("mousemove",function(t){r.mouseMove(t)},!1),this.canvasProtein.addEventListener("keydown",function(t){r.keyDown(t)},!1),this.canvasProtein.addEventListener("mouseout",function(t){r.mouseOut(t)},!1),"Firefox"==this.browserName?this.canvasProtein.addEventListener("DOMMouseScroll",function(t){r.mouseWheel(t)},!1):this.canvasProtein.addEventListener("mousewheel",function(t){r.mouseWheel(t)},!1),"POSITIVE"==this.strand||(this.geneStrucBlocks=this.geneStrucBlocks.reverse()),this.canvasProtein.height="400","undefined"==typeof this.isoform2||null!=this.isofrom2)return this.canvasProtein.height="400",null;for(var h=0,l=-1,a=-1,c=0;c<this.geneStrucBlocks.length;c++){var u=this.geneStrucBlocks[c].begPos,d=this.geneStrucBlocks[c].endPos,f=this.geneStrucBlocks[c].ifAS,p=(d-u+1)/3;f&&(-1!=l&&a!=h?a=Math.floor(h+p):(-1!=l&&this.alternativeSplicingRegions.push({begPos:l,endPos:a}),l=Math.floor(h),a=Math.floor(h+p))),h+=p}-1!=l&&this.alternativeSplicingRegions.push({begPos:l,endPos:a});for(var P=0;P<this.alternativeSplicingRegions.length;++P){for(var m=this.alternativeSplicingRegions[P].begPos,v=this.alternativeSplicingRegions[P].endPos,g=Math.floor(v-m),y=this.isoform2.pfams.length,x=0;y>x;++x){var S=this.isoform2.pfams[x],W=S.begPos,A=S.endPos;m>W&&A>m?(this.isoform2.pfams[x].endPos=m,W=v,A+=g,this.isoform2.pfams.push({begPos:W,endPos:A,description:S.description,pfamFamily:S.pfamFamily})):(W>m&&(this.isoform2.pfams[x].begPos=W+g),A>m&&(this.isoform2.pfams[x].endPos=A+g))}for(var x=0;g>x;++x)this.isoform2.disorderValue.splice(m,0,0);this.start,e.proteinSequence.substring(0,m);for(var b="",x=0;g>x;++x)b+=" ";this.isoform2.polarity=this.isoform2.polarity.substring(0,m)+b+this.isoform2.polarity.substring(m,this.isoform2.polarity.length),this.isoform2.charge=this.isoform2.charge.substring(0,m)+b+this.isoform2.charge.substring(m,this.isoform2.charge.length),this.isoform2.proteinSequence=this.isoform2.proteinSequence.substring(0,m)+b+this.isoform2.proteinSequence.substring(m,this.isoform2.proteinSequence.length)}}},ASPlot.ProteinPlot.prototype.mouseDown=function(t){this.mouseIsDown=!0;var i=getOffset(t);this.x=i.x,this.y=i.y},ASPlot.ProteinPlot.prototype.mouseWheel=function(t){var i=t.wheelDelta;"Firefox"==this.browserName&&(i=t.detail);t.shiftKey;0>i?(this.unitWidth--,this.unitWidth<this.minUnitWidth&&(this.unitWidth=this.minUnitWidth)):(this.unitWidth++,this.unitWidth>this.maxUnitWidth&&(this.unitWidth=this.maxUnitWidth));var e=this.end-Math.round((this.canvasProteinWidth-this.leftWidth)/this.unitWidth)+13;0>e&&(e=0),this.currentPosition>e&&(this.currentPosition=e),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot()},ASPlot.ProteinPlot.prototype.mouseOut=function(t){this.mouseIsDown=!1},ASPlot.ProteinPlot.prototype.mouseUp=function(t){this.mouseIsDown=!1},ASPlot.ProteinPlot.prototype.mouseMove=function(t){var i=getOffset(t),e=i.x,n=i.y;if(this.mouseIsDown&&Math.abs(e-this.x)>this.moveWidth){var o=e-this.x+this.residue;this.residue=o%this.unitWidth,this.currentPosition=this.currentPosition+parseInt(-1*o/this.unitWidth);var s=this.end-Math.round((this.canvasProteinWidth-this.leftWidth)/this.unitWidth)+13;0>s&&(s=0),this.currentPosition>s&&(this.currentPosition=s),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot(),this.x=e,this.y=n}else(Math.abs(e-this.moveLastX)>this.moveWidth/2||Math.abs(n-this.moveLastY)>this.moveWidth/2)&&(this.contextProtein.beginPath(),this.contextProtein.strokeStyle="#000000",this.contextProtein.lineWidth=2,this.contextProtein.putImageData(this.imgData,0,0),this.imgData=this.contextProtein.getImageData(0,0,this.canvasProtein.width,this.canvasProtein.height),this.contextProtein.moveTo(0,n),this.contextProtein.lineTo(this.canvasProteinWidth,n),this.contextProtein.moveTo(e,0),this.contextProtein.lineTo(e,this.canvasProtein.height),this.contextProtein.stroke(),this.moveLastX=e,this.moveLastY=n)},ASPlot.ProteinPlot.prototype.keyDown=function(t){39==t.keyCode&&(this.currentPosition+=1),37==t.keyCode&&(this.currentPosition+=-1);var i=this.end-Math.round((this.canvasProtein.width-this.leftWidth)/this.unitWidth)+13;0>i&&(i=0),this.currentPosition>i&&(this.currentPosition=i),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot()},ASPlot.ProteinPlot.prototype.plot=function(){this.contextProtein.beginPath(),this.contextProtein.clearRect(0,0,this.canvasProtein.width,this.canvasProtein.height);var t=30;"undefined"!=typeof this.isoform2&&null!=this.isoform2&&(t+=this.disPlot(t,this.isoform2),t+=this.pfamPlot(t,this.isoform2),t+=this.plotAlphabet(t,this.isoform2),t+=this.plotCharge(t,this.isoform2),t+=this.plotPolarity(t,this.isoform2),t+=this.plotProteinBlocks(t,!0)),this.coordinatePosition=t,t+=this.plotCoordinate(t),t+=this.plotProteinBlocks(t,"undefined"==typeof this.isoform2?!0:!1),t+=this.plotPolarity(t,this.isoform1),t+=this.plotCharge(t,this.isoform1),t+=this.plotAlphabet(t,this.isoform1),t+=this.pfamPlot(t,this.isoform1),t+=this.asaPlot(t,this.isoform1),t+=this.alpha_helixPlot(t,this.isoform1),t+=this.beta_sheetPlot(t,this.isoform1),t+=this.random_coilPlot(t,this.isoform1),t+=this.disPlot(t,this.isoform1),this.plotDecoration(),this.contextProtein.stroke(),this.imgData=this.contextProtein.getImageData(0,0,this.canvasProtein.width,this.canvasProtein.height)},ASPlot.ProteinPlot.prototype.plotDecoration=function(){this.contextProtein.fillStyle="#000000","undefined"!=typeof this.isoform2&&null!=this.isoform2&&(this.contextProtein.moveTo(this.leftWidth-20,15),this.contextProtein.lineTo(this.leftWidth-10,10),this.contextProtein.moveTo(this.leftWidth-10,10),this.contextProtein.lineTo(this.leftWidth,15),this.contextProtein.moveTo(this.leftWidth-10,10),this.contextProtein.lineTo(this.leftWidth-10,this.coordinatePosition-5),this.contextProtein.moveTo(this.leftWidth-20,this.coordinatePosition-10),this.contextProtein.lineTo(this.leftWidth-10,this.coordinatePosition-5),this.contextProtein.moveTo(this.leftWidth-10,this.coordinatePosition-5),this.contextProtein.lineTo(this.leftWidth,this.coordinatePosition-10),this.contextProtein.save(),this.contextProtein.translate(0,0),this.contextProtein.rotate(-Math.PI/2),this.contextProtein.fillText("AS isoform",10-this.coordinatePosition,this.leftWidth-25),this.contextProtein.fillText("Canonical isoform",100-this.canvasProtein.height,this.leftWidth-20),this.contextProtein.restore()),this.contextProtein.moveTo(this.leftWidth-20,this.coordinatePosition+30),this.contextProtein.lineTo(this.leftWidth-10,this.coordinatePosition+20),this.contextProtein.moveTo(this.leftWidth-10,this.coordinatePosition+20),this.contextProtein.lineTo(this.leftWidth,this.coordinatePosition+30),this.contextProtein.moveTo(this.leftWidth-10,this.coordinatePosition+20),this.contextProtein.lineTo(this.leftWidth-10,this.canvasProtein.height-10),this.contextProtein.moveTo(this.leftWidth-20,this.canvasProtein.height-15),this.contextProtein.lineTo(this.leftWidth-10,this.canvasProtein.height-10),this.contextProtein.moveTo(this.leftWidth-10,this.canvasProtein.height-10),this.contextProtein.lineTo(this.leftWidth,this.canvasProtein.height-15)},ASPlot.ProteinPlot.prototype.plotAlphabet=function(t,i){if(this.unitWidth<this.minFontWidth)return 0;var e=i.proteinSequence.substring(this.currentPosition-this.start,i.proteinSequence.length),n=this.currentPosition+this.canvasProteinWidth/this.unitWidth;return this.plotEngine.alphabetPlot(this.contextProtein,e,this.currentPosition,n,this.unitWidth,t,this.leftWidth,"amino acid"),35},ASPlot.ProteinPlot.prototype.plotPolarity=function(t,i){if(this.unitWidth<this.minFontWidth)return 0;var e=i.polarity.substring(this.currentPosition-this.start,i.polarity.length),n=this.currentPosition+this.canvasProteinWidth/this.unitWidth;return this.plotEngine.alphabetPlotColorTable(this.contextProtein,e,this.currentPosition,n,this.unitWidth,t,this.leftWidth,"polarity"),35},ASPlot.ProteinPlot.prototype.plotCharge=function(t,i){if(this.unitWidth<this.minFontWidth)return 0;var e=i.charge.substring(this.currentPosition-this.start,i.charge.length),n=this.currentPosition+this.canvasProteinWidth/this.unitWidth;return this.plotEngine.alphabetPlotColorTable(this.contextProtein,e,this.currentPosition,n,this.unitWidth,t,this.leftWidth,"charge"),35},ASPlot.ProteinPlot.prototype.plotCoordinate=function(t){var i=this.currentPosition+this.canvasProteinWidth/this.unitWidth;return this.plotEngine.coordinatePlotAS(this.contextProtein,this.alternativeSplicingRegions,this.currentPosition,i,this.canvasProteinWidth,50,this.unitWidth,t,"#aa66aa",this.leftWidth,"coordinate"),35},ASPlot.ProteinPlot.prototype.plotProteinBlocks=function(t,i){var e=this.currentPosition+this.canvasProteinWidth/this.unitWidth;0!=this.leftWidth&&(this.contextProtein.fillStyle="#000000",this.contextProtein.font="13px monospace",this.contextProtein.fillText("exons",0,t+15)),this.contextProtein.fillStyle="#800000",this.contextProtein.font="10px monospace",("undefined"==typeof color||null==color)&&(color="#800000"),("undefined"==typeof height||null==height)&&(rowHeight=20),this.contextProtein.fillStyle=color;var n=0;color="#800000",this.contextProtein.fillStyle=color;for(var o=0;o<this.geneStrucBlocks.length;o++){var s=this.geneStrucBlocks[o].begPos,r=this.geneStrucBlocks[o].endPos,h=this.geneStrucBlocks[o].ifAS;if(!this.ifASOut||!h){var l=(r-s+1)/3,a=n+1,c=a+l;if(n+=l,!(c<this.currentPosition||a>e)){a=a>this.currentPosition?a:this.currentPosition,c=e>c-.3?c-.3:e;var u=Math.floor(c-a+1);h&&i?this.contextProtein.fillStyle="#FA8072":this.contextProtein.fillStyle="#800000",this.contextProtein.fillRect(this.leftWidth+(a-this.currentPosition)*this.unitWidth,t,u*this.unitWidth,20)}}}return 35},ASPlot.ProteinPlot.prototype.pfamPlot=function(t,i){var e=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=i.pfams,o=this.plotEngine.blocksPlotPipeLine(this.contextProtein,n,this.currentPosition,e,this.canvasProteinWidth,20,this.unitWidth,t,"#808000",this.leftWidth,"pfam");return o},ASPlot.ProteinPlot.prototype.disPlot=function(t,i){var e=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=i.disorderValue;return this.plotEngine.continuousValuePlot(this.contextProtein,n,this.currentPosition,e,this.unitWidth,t,this.leftWidth,"disprot"),35},ASPlot.ProteinPlot.prototype.asaPlot=function(t,i){var e=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=i.asaValue;return this.plotEngine.continuousValuePlot(this.contextProtein,n,this.currentPosition,e,this.unitWidth,t,this.leftWidth,"asa"),35},ASPlot.ProteinPlot.prototype.random_coilPlot=function(t,i){var e=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=i.random_coilValue;return this.plotEngine.continuousValuePlot(this.contextProtein,n,this.currentPosition,e,this.unitWidth,t,this.leftWidth,"random_coil"),35},ASPlot.ProteinPlot.prototype.beta_sheetPlot=function(t,i){var e=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=i.beta_sheetValue;return this.plotEngine.continuousValuePlot(this.contextProtein,n,this.currentPosition,e,this.unitWidth,t,this.leftWidth,"beta_sheet"),35},ASPlot.ProteinPlot.prototype.alpha_helixPlot=function(t,i){var e=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=i.alpha_helixValue;return this.plotEngine.continuousValuePlot(this.contextProtein,n,this.currentPosition,e,this.unitWidth,t,this.leftWidth,"alpha_helix"),35},ASPlot.GenePlot=function(t,i){this.plotLeft=!0,this.leftWidth=120,this.plotEngine=i,this.canvasGene=document.getElementById("geneVisual"),this.contextGene=this.canvasGene.getContext("2d"),this.canvasGeneWidth=this.canvasGene.width,this.strand=t.getStrand(),this.currentPosition=-1,this.unitwidth=-1,this.x=-1,this.y=-1,this.mouseIsDown=!1,this.moveWidth=15,this.imgData,this.moveLastX=-1,this.moveLastY=-1,this.unitWidth=11,this.maxUnitWidth=15,this.minUnitWidth=.01,this.minFontWidth=7,this.residue=0;var e=t.parseGeneSequence();this.conservation=t.parseConservationScore(),this.geneSequence=e.sequence,this.start=parseInt(e.start),this.end=parseInt(e.end),this.geneStrucBlocks=t.parseASExons(),this.currentPosition=this.start,this.browserName=getBrowserName();var n=this,o=document.getElementById("gotoposition");o.addEventListener("click",function(){var t=document.getElementById("coordiantePosition");console.log(t.value),n.go(t.value)},!1),this.canvasGene.addEventListener("mouseup",function(t){n.mouseUp(t)},!1),this.canvasGene.addEventListener("mousedown",function(t){n.mouseDown(t)},!1),this.canvasGene.addEventListener("mousemove",function(t){n.mouseMove(t)},!1),this.canvasGene.addEventListener("keydown",function(t){n.keyDown(t)},!1),this.canvasGene.addEventListener("mouseout",function(t){n.mouseOut(t)},!1),"Firefox"==this.browserName?this.canvasGene.addEventListener("DOMMouseScroll",function(t){n.mouseWheel(t)},!1):this.canvasGene.addEventListener("mousewheel",function(t){n.mouseWheel(t)},!1)},ASPlot.GenePlot.prototype.mouseDown=function(t){this.mouseIsDown=!0,this.x=t.clientX,this.y=t.clientY},ASPlot.GenePlot.prototype.mouseWheel=function(t){var i=t.wheelDelta;"Firefox"==this.browserName&&(i=t.detail);t.shiftKey;0>i?(this.unitWidth<=1?this.unitWidth=this.unitWidth/1.2:this.unitWidth--,this.unitWidth<this.minUnitWidth&&(this.unitWidth=this.minUnitWidth)):(this.unitWidth<=1?this.unitWidth=1.2*this.unitWidth:this.unitWidth++,this.unitWidth>this.maxUnitWidth&&(this.unitWidth=this.maxUnitWidth));var e=this.end-Math.round((this.canvasGeneWidth-this.leftWidth)/this.unitWidth)+13;0>e&&(e=0),this.currentPosition>e&&(this.currentPosition=e),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot()},ASPlot.GenePlot.prototype.mouseOut=function(t){this.mouseIsDown=!1},ASPlot.GenePlot.prototype.mouseUp=function(t){this.mouseIsDown=!1},ASPlot.GenePlot.prototype.go=function(t){this.currentPosition=parseInt(t),this.plot()},ASPlot.GenePlot.prototype.mouseMove=function(t){var i=void 0==t.offsetX?t.layerX:t.offsetX,e=void 0==t.offsetY?t.layerY:t.offsetY;if(this.mouseIsDown&&Math.abs(i-this.x)>this.moveWidth){document.body.style.cursor="default";var n=i-this.x+this.residue;this.residue=n%this.unitWidth,this.currentPosition=this.currentPosition+parseInt(-1*n/this.unitWidth);var o=this.end-Math.round((this.canvasGeneWidth-this.leftWidth)/this.unitWidth)+13;0>o&&(o=0),this.currentPosition>o&&(this.currentPosition=o),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot(),this.x=i,this.y=e}else Math.abs(i-this.moveLastX)>this.moveWidth/2&&(this.contextGene.beginPath(),this.contextGene.strokeStyle="#000000",this.contextGene.lineWidth=1,this.contextGene.putImageData(this.imgData,0,0),this.imgData=this.contextGene.getImageData(0,0,this.canvasGene.width,this.canvasGene.height),this.contextGene.moveTo(0,e),this.contextGene.lineTo(this.canvasGeneWidth,e),this.contextGene.moveTo(i,0),this.contextGene.lineTo(i,this.canvasGene.height),this.contextGene.stroke(),this.moveLastX=i)},ASPlot.GenePlot.prototype.moveLeft=function(){this.currentPosition-=1,this.plot()},ASPlot.GenePlot.prototype.moveRight=function(){this.currentPosition+=1,this.plot()},ASPlot.GenePlot.prototype.keyDown=function(t){console.log(2),37==t.keyCode&&(this.currentPosition+=1),39==t.keyCode&&(this.currentPosition+=-1);var i=this.end-Math.round((this.canvasGeneWidth-this.leftWidth)/this.unitWidth)+13;0>i&&(i=0),this.currentPosition>i&&(this.currentPosition=i),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot()},ASPlot.GenePlot.prototype.plot=function(){this.contextGene.beginPath(),this.contextGene.clearRect(0,0,this.canvasGene.width,this.canvasGene.height);var t=20;t+=this.plotCoordinate(t),t+=this.plotAlphabet(t),t+=this.plotGeneBlocks(t),t+=this.plotConservation(t),t+=this.plotStrand(t),this.contextGene.stroke(),this.imgData=this.contextGene.getImageData(0,0,this.canvasGene.width,this.canvasGene.height)},ASPlot.GenePlot.prototype.plotAlphabet=function(t){if(this.unitWidth<this.minFontWidth)return 0;var i=this.geneSequence.substring(this.currentPosition-this.start,this.geneSequence.length),e=this.currentPosition+parseInt(this.canvasGeneWidth/this.unitWidth);return this.plotEngine.alphabetPlot(this.contextGene,i,this.currentPosition,e,this.unitWidth,t,this.leftWidth,"DNA"),35},ASPlot.GenePlot.prototype.plotCoordinate=function(t){var i=this.currentPosition+parseInt(this.canvasGeneWidth/this.unitWidth);return this.plotEngine.coordinatePlot(this.contextGene,this.data,this.currentPosition,i,this.canvasGeneWidth,30,this.unitWidth,t,"#000000",this.leftWidth,"coordinate"),35},ASPlot.GenePlot.prototype.plotGeneBlocks=function(t){var i=this.currentPosition+this.canvasGeneWidth/this.unitWidth;return this.plotEngine.blocksPlotWithLineAS(this.contextGene,this.geneStrucBlocks,this.currentPosition,i,this.canvasGeneWidth,20,this.unitWidth,t,"#800000",this.leftWidth,"geneExons"),35},ASPlot.GenePlot.prototype.plotKnownAlt=function(t){var i=this.currentPosition+this.canvasGeneWidth/this.unitWidth;return this.plotEngine.blocksPlot(this.contextGene,this.knownAlt,this.currentPosition,i,this.canvasGeneWidth,20,this.unitWidth,t,"#FA8072",this.leftWidth,"knowAltUCSC"),35},ASPlot.GenePlot.prototype.plotConservation=function(t){var i=this.currentPosition+this.canvasGeneWidth/this.unitWidth;return this.plotEngine.continuousValuePlot(this.contextGene,this.conservation,this.currentPosition-this.start,i-this.start,this.unitWidth,t,this.leftWidth,"phastCons100way"),35},ASPlot.GenePlot.prototype.plotStrand=function(t){return this.plotEngine.plotStrand(this.contextGene,this.leftWidth,this.canvasGeneWidth,t,"strand",this.strand),35},ASPlot.transcriptPlot=function(t,i){this.leftWidth=200,this.xmlParser=t,this.plotEngine=i,this.canvas2=document.getElementById("transcriptsVisual"),this.context2=this.canvas2.getContext("2d"),this.transcripts=this.xmlParser.parseTranscripts(),this.canvas2.height=30*this.transcripts.length+60},ASPlot.transcriptPlot.prototype.plotAS=function(){this.context1.beginPath();var t=parseInt(this.data[0].begPos),i=parseInt(this.data[this.data.length-1].endPos),e=this.canvas1.width,n=(e-this.leftWidth)/(i-t+1);this.plotEngine.coordinatePlot(this.context1,this.data,t,i,e,50,n,10,"#aa66aa",this.leftWidth),this.plotEngine.blocksPlotWithLineAS(this.context1,this.data,t,i,e,50,n,30,"#aa66aa"),this.context1.stroke()},ASPlot.transcriptPlot.prototype.plot=function(){if(null!=this.transcripts&&0!=this.transcripts.length){this.context2.beginPath();var t=1e9,i=-1;for(var e in this.transcripts){var n=this.transcripts[e].blocks;for(var o in n){var s=parseInt(n[o].begPos),r=parseInt(n[o].endPos);t>s&&(t=s),r>i&&(i=r)}}var h=this.canvas2.width,l=(h-this.leftWidth)/(i-t+1),a=30;this.plotEngine.coordinatePlot(this.context2,this.transcripts,t,i,h,30,l,a,"#aa66aa",this.leftWidth,"coordinate"),a+=30;for(var c=0;c<this.transcripts.length;c++)this.plotEngine.blocksPlotWithLineAS(this.context2,this.transcripts[c].blocks,t,i,h,20,l,a,"#aa66aa",this.leftWidth,this.transcripts[c].ID),a+=25;this.context2.stroke()}},ASPlot.xmlParser=function(){},ASPlot.xmlParser.prototype.parseConservationScore=function(){var t=this.eventNodes[0].getElementsByTagName("conservation"),i=(null==t[0].innerHTML?t[0].textContent:t[0].innerHTML).split(" ");return i},ASPlot.xmlParser.prototype.parseKnownAlt=function(){for(var t=[],i=this.eventNodes[0].getElementsByTagName("ucscaltevent"),e=i[0].childNodes,n=0;n<e.length;++n){var o=parseInt(e[n].getAttribute("start")),s=parseInt(e[n].getAttribute("end"));t.push({begPos:o,endPos:s})}return t},ASPlot.xmlParser.prototype.parseASExons=function(){this.blocks=[];for(var t=this.eventNodes[0].getElementsByTagName("alternativeExons"),i=t[0].childNodes,e=0;e<i.length;++e){var n=parseInt(i[e].getAttribute("start")),o=parseInt(i[e].getAttribute("end")),s=i[e].getAttribute("IfAlternative"),r=Boolean("true"==s);this.blocks.push({begPos:n,endPos:o,ifAS:r})}return this.blocks},ASPlot.xmlParser.prototype.parseTranscript=function(){this.blocks=[];for(var t=this.eventNodes[0].getElementsByTagName("transcript"),i=t[0].childNodes,e=0;e<i.length;++e){var n=parseInt(i[e].getAttribute("cds_start")),o=parseInt(i[e].getAttribute("cds_end"));if(-1!=n&&-1!=o){var s=i[e].getAttribute("IfAlternative"),r=Boolean("true"==s);this.blocks.push({begPos:n,endPos:o,ifAS:r})}}return this.blocks},ASPlot.IsoformStruct=function(){this.proteinSequence="",this.pfams,this.disorderString=""},ASPlot.IsoformStruct.prototype.setProteinSequence=function(t){this.proteinSequence=t},ASPlot.xmlParser.prototype.parseIsoforms=function(){for(var t=this.eventNodes[0].getElementsByTagName("isoform"),i=new Array,e=0;e<t.length;e++){var n=(t[e].children,new ASPlot.IsoformStruct),o=null==t[e].getElementsByTagName("proteinSequence")[0].innerHTML?t[e].getElementsByTagName("proteinSequence")[0].textContent:t[e].getElementsByTagName("proteinSequence")[0].innerHTML;n.proteinSequence=o;for(var s=t[e].getElementsByTagName("pfam_domain"),r=[],h=0;h<s.length;h++){var l=parseInt(s[h].getAttribute("start")),a=parseInt(s[h].getAttribute("end")),c=s[h].getAttribute("description"),u=s[h].getAttribute("family");r.push({begPos:l,endPos:a,description:c,pfamFamily:u})}n.pfams=r;var d=t[e].getElementsByTagName("disProt_value")[0],f=d.getAttribute("disOrder_string"),p=(null==d.innerHTML?d.textContent:d.innerHTML).split(" ");n.disorderValue=p,n.disorderString=f;var P=t[e].getElementsByTagName("asa")[0],m=(null==P.innerHTML?P.textContent:P.innerHTML).split(" ");n.asaValue=m;var v=t[e].getElementsByTagName("random_coil")[0],g=(null==v.innerHTML?v.textContent:v.innerHTML).split(" ");n.random_coilValue=g;var y=t[e].getElementsByTagName("beta_sheet")[0],x=(null==y.innerHTML?y.textContent:y.innerHTML).split(" ");n.beta_sheetValue=x;var S=t[e].getElementsByTagName("alpha_helix")[0],W=(null==S.innerHTML?S.textContent:S.innerHTML).split(" ");n.alpha_helixValue=W;var A=new Object;A.A="n",A.R="b",A.N="p",A.D="p",A.C="n",A.E="a",A.Q="p",A.G="n",A.H="b",A.I="b",A.L="n",A.K="b",A.M="n",A.F="n",A.P="n",A.S="p",A.T="p",A.W="n",A.X="n",A.Y="p",A.V="n";var b=new Object;b.A="n",b.R="p",b.N="n",b.D="g",b.C="n",b.E="g",b.Q="n",b.G="n",b.H="n",b.I="n",b.L="n",b.K="p",b.M="n",b.F="n",b.P="n",b.S="n",b.T="n",b.W="n",b.X="n",b.Y="n",b.V="n",n.polarity="",n.charge="";for(var T=0;T<n.proteinSequence.length;++T)n.polarity+=A[n.proteinSequence[T]],
n.charge+=b[n.proteinSequence[T]];i.push(n)}return i},ASPlot.xmlParser.prototype.parseGeneSequence=function(){var t=this.eventNodes[0].getElementsByTagName("geneSequence"),i=null==t[0].innerHTML?t[0].textContent:t[0].innerHTML,e=t[0].getAttribute("start"),n=t[0].getAttribute("end");return{sequence:i,start:e,end:n}},ASPlot.xmlParser.prototype.parseTranscripts=function(){this.transcirpts=[];for(var t=this.eventNodes[0].getElementsByTagName("transcript"),i=0;i<t.length;i++){for(var e=[],n=t[i].childNodes,o=t[i].getAttribute("ID"),s=0;s<n.length;++s){var r=parseInt(n[s].getAttribute("start")),h=parseInt(n[s].getAttribute("end")),l=Boolean("true"==n[s].getAttribute("IfAlternative"));e.push({begPos:r,endPos:h,ifAS:l})}this.transcirpts.push({ID:o,blocks:e})}return this.transcirpts},ASPlot.xmlParser.prototype.getStrand=function(){var t=this.eventNodes[0].getElementsByTagName("strand");return null==t[0].innerHTML?t[0].textContent:t[0].innerHTML},ASPlot.xmlParser.prototype.parseXML=function(t){return window.XMLHttpRequest?xmlHttp=new XMLHttpRequest:xmlHttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlHttp.open("GET",t,!1),xmlHttp.send(null),this.xmldoc=xmlHttp.responseXML.documentElement,this.eventNodes=this.xmldoc.getElementsByTagName("event"),this},ASPlot.submitQuery=function(){var t=document.getElementById("searchFild").value;if("undefined"!=typeof t&&null!=t&&""!=t){var i=new ASPlot.firstPage(t);i.plotAS(),i.plotTranscript()}};