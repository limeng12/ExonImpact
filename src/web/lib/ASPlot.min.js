function cumulativeOffset(t){var e=0,i=0;do e+=t.offsetTop||0,i+=t.offsetLeft||0,t=t.offsetParent;while(t);return{top:e,left:i}}function getOffset(t){if(void 0!=t.offsetX)return{x:t.offsetX,y:t.offsetY};for(var e=t.target,i={x:0,y:0};e.offsetParent;)i.x+=e.offsetLeft,i.y+=e.offsetTop,e=e.offsetParent;return i.x=t.pageX-i.x,i.y=t.pageY-i.y,i}function getBrowserName(){var t=navigator.appName,e=navigator.userAgent;return-1!=(verOffset=e.indexOf("Opera"))?t="Opera":-1!=(verOffset=e.indexOf("MSIE"))?t="Microsoft Internet Explorer":-1!=(verOffset=e.indexOf("Chrome"))?t="Chrome":-1!=(verOffset=e.indexOf("Safari"))?t="Safari":-1!=(verOffset=e.indexOf("Firefox"))&&(t="Firefox"),t}function submitQueryEvent(t){return!0}function leftPanelButtonOver(){document.images.leftPanelButton.src="lib/xl.jpg";var t=document.getElementById("leftPanelControl");t.style.display="block"}function validatFrom(){return!1}function leftPanelButtonOut(){document.images.leftPanelButton.src="lib/xx.jpg";var t=document.getElementById("leftPanelControl");t.style.display="none"}function leftPanelExpand(){}function checkBox(t){var e=t.checked,i=t.value;if("GenePart"==i){var n=document.getElementById("geneVisualModule");e?n.style.display="block":n.style.display="none"}if("proteinPart"==i){var n=document.getElementById("proteinVisualModule1");e?n.style.display="block":n.style.display="none"}if("transcriptPart"==i){var n=document.getElementById("transcriptsVisualModule");e?n.style.display="block":n.style.display="none"}}function validate_form(t){var e="chr\\w+:(\\d+):(\\d+):(\\+|-)@chr\\w+:(\\d+):(\\d+):(\\+|-)@chr\\w+:(\\d+):(\\d+):(\\+|-)",i="chr\\w+:(\\d+):(\\d+)\\|(\\d+):(\\+|-)@chr(\\w+):(\\d+):(\\d+):(\\+|-)",n="chr(\\w+):(\\d+):(\\d+):(\\+|-)@chr\\w+:(\\d+)\\|(\\d+):(\\d+):(\\+|-)",o="chr(\\w+):(\\d+)-(\\d+):(\\+|-)@chr(\\w+):(\\d+)-(\\d+):(\\+|-)",s="^ENST",r="^uc",h="^NM",l="(@chr\\w+:(\\d+):(\\d+):(\\+-)((:Splice)*))+",a=document.getElementById("searchFild"),c=a.value,u=new RegExp(e),d=new RegExp(i),f=new RegExp(n),p=new RegExp(o),P=new RegExp(s),m=new RegExp(r),v=new RegExp(h),v=new RegExp(l),g=u.test(c);if(g=d.test(c)||g,g=f.test(c)||g,g=p.test(c)||g,g=P.test(c)||g,g=m.test(c)||g,g=v.test(c)||g,0==g)return alert("Your input format is not right."),!1;var y=document.getElementById("searchFild"),c=y.value;document.cookie="eventId="+c;var x=document.getElementById("submitQuery"),S=cumulativeOffset(x).left,W=cumulativeOffset(x).top;x.style.display="none";var A=document.getElementById("loadingGif");return A.style.display="block",A.style.position="absolute",A.style.left=S+"px",A.style.top=W-50+"px",!0}function initFirstPage(){}function initVisualPage(t){var e=document.getElementById("mainPage");e.style.width=document.documentElement.clientWidth-12+"px";var i=document.documentElement.clientWidth-20,n=document.getElementById("geneVisual");if("undefined"!=typeof n&&null!=n){n.width=i;var o=document.getElementById("proteinVisual1");o.width=i;var s=document.getElementById("transcriptsVisual");s.width=i;var r=new ASPlot.visualPage(t+".xml");r.genePlot.plot(),null!=r.proteinPlot1&&r.proteinPlot1.plot(),null!=r.transcriptPlot&&r.transcriptPlot.plot()}}function browser_init(t){console.log("your input xml is: "+t+".xml"),window.addEventListener;navigator.userAgent.toLowerCase();initFirstPage(),initVisualPage(t)}var ASPlot={};ASPlot.Utility=function(){},ASPlot.Utility.prototype.plotStrand=function(t,e,i,n,o,s){0!=e&&(t.font="13px monospace",t.fillText(o,0,n+15)),t.fillText(s,i/2,n+15)},ASPlot.Utility.prototype.continuousValuePlot=function(t,e,i,n,o,s,r,h){t.fillStyle="#000000",t.fillStyle="#000000",t.font="10px monospace",0!=r&&(t.font="13px monospace",t.fillText(h,0,s+15));for(var l=0;l<e.length;++l)e[l]=parseFloat(e[l]),i>l+1||l+1>n||t.fillRect(r+(1+l-i)*o,s+15*(1-e[l]),14,15*e[l])},ASPlot.Utility.prototype.alphabetPlot=function(t,e,i,n,o,s,r,h){0!=r&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(h,0,s+15)),t.fillStyle="#000000",t.font="10px monospace",t.font=200/114*o+"px monospace";for(var l=0,a=0;n-i>a&&!(a>e.length-1);++a)t.fillText(e[a],r+l,s+15),l+=o},ASPlot.Utility.prototype.alphabetPlotColorTable=function(t,e,i,n,o,s,r,h){0!=r&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(h,0,s+15)),t.fillStyle="#000000",t.font="10px monospace",t.font=200/114*o+"px monospace";for(var l=0,a=0;n-i>a&&!(a>e.length-1);++a)"b"==e[a]?t.fillStyle="#FA8072":"n"==e[a]?t.fillStyle="#8470FF":"g"==e[a]?t.fillStyle="#DAA520":"p"==e[a]?t.fillStyle="#98FB98":"a"==e[a]?t.fillStyle="#00FFFF":t.fillStyle="#ffffff",t.fillRect(r+l,s,o,28),t.fillStyle="#000000",t.fillText(e[a],r+l,s+22),l+=o},ASPlot.Utility.prototype.coordinatePlotAS=function(t,e,i,n,o,s,r,h,l,a,c){0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,h+15)),t.fillStyle="#000000",t.strokeStyle="#000000",t.lineWidth=2,t.font="10px monospace";var u=i,d=n,f=0,p=100;r>=5&&(p=100-100%r,console.log(p+" "+r));for(var P=0;P<Math.round(d-u);){var m=0;t.moveTo(a+(P+f)*r,h+5),t.lineTo(a+(P+f)*r,h+15);var v=parseInt(t.measureText(Math.round(u+P+f)).width);if(a+Math.round(P+f)*r+parseFloat(v)-o>0)break;for(var g=Math.round(u+P+f),y=0;y<e.length&&!(g<e[y].begPos);++y)m+=g>e[y].endPos?e[y].endPos-e[y].begPos:g-e[y].begPos;g+="("+(g-parseInt(m))+")",t.fillText(g,a+Math.round(P+f)*r,h),P+=p/r}t.moveTo(a+0,h+15),t.lineTo(o,h+15)},ASPlot.Utility.prototype.coordinatePlot=function(t,e,i,n,o,s,r,h,l,a,c){0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,h+15)),t.fillStyle="#000000",t.strokeStyle="#000000",t.lineWidth=2,t.font="10px monospace";var u=i,d=n,f=100;r>=5&&(f=100-100%r,console.log(f+" "+r));for(var p=0,P=0;P<Math.round(d-u);){t.moveTo(a+(P+p)*r,h+5),t.lineTo(a+(P+p)*r,h+15);var m=parseInt(t.measureText(Math.round(u+P+p)).width);if(a+Math.round(P+p)*r+parseFloat(m)-o>0)break;t.fillText(Math.round(u+P+p),a+Math.round(P+p)*r,h),P+=f/r}t.moveTo(a+0,h+15),t.lineTo(o,h+15)},ASPlot.Utility.prototype.pointPlot=function(t,e,i,n,o,s,r,h,l,a,c){var u=h;t.fillStyle="#000000",t.font="12px monospace",("undefined"==typeof l||null==l)&&(l="#800000"),("undefined"==typeof h||null==h)&&(s=40),t.fillStyle=l;var d,f=0,p=-1;for(var P in e){var m=e[P].begPos;if(!(m>n)){var v=m>i?m:i;-1!=p&&50>(v-p)*r?(h+=s,f++,f>d&&(d=f),console.log("The threshold pixel is: "+(v-p)*r)):(f=0,h=u);var g=e[P].begPos;if(!(i>g)){var y=g-v+1;t.fillStyle=l,t.fillRect(a+(v-i)*r,h,y*r,s);var x=e[P].description;t.fillStyle="#000000",t.fillText(x,a+(v-i)*r,h+s-4),0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,u+15)),p=v}}}return(0==d?1:d)*(s+10)},ASPlot.Utility.prototype.blocksPlotPipeLine=function(t,e,i,n,o,s,r,h,l,a,c){var u=h;t.fillStyle="#000000",t.font="12px monospace",("undefined"==typeof l||null==l)&&(l="#800000"),("undefined"==typeof h||null==h)&&(s=40),t.fillStyle=l;var d=0;for(var f in e){var p=e[f].begPos;if(!(p>n)){var P=p>i?p:i,m=e[f].endPos;if(!(i>m)){var v=m-P+1;t.fillStyle=l,t.fillRect(a+(P-i)*r,h,v*r,s);var g=e[f].description;t.fillStyle="#000000",t.fillText(g,a+(P-i)*r,h+s-4),h+=s,d++,0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,u+15))}}}return d*(s+10)},ASPlot.Utility.prototype.blocksPlot=function(t,e,i,n,o,s,r,h,l,a,c){0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,h+15)),t.fillStyle="#000000",("undefined"==typeof l||null==l)&&(l="#800000"),("undefined"==typeof h||null==h)&&(s=20),t.fillStyle=l;for(var u in e){var d=e[u].begPos;if(!(d>n)){var f=d>i?d:i,p=e[u].endPos;if(!(i>p)){var P=p-f+1;t.fillRect(a+(f-i)*r,h,P*r,s)}}}},ASPlot.Utility.prototype.blocksPlotWithLine=function(t,e,i,n,o,s,r,h,l){("undefined"==typeof l||null==l)&&(l="#800000"),("undefined"==typeof h||null==h)&&(s=20),t.fillStyle=l,t.strokeStyle="#000000",t.lineWidth=2;var a=-1,c=-1,u=-1;for(var d in e){var f=e[d].begPos,a=f>i?f:i,c=i>c?i:c;t.moveTo((c-i)*r,h+s/2),t.lineTo((c-i+(a-c)/2)*r,h),t.moveTo((c-i+(a-c)/2)*r,h),t.lineTo((a-i)*r,h+s/2);var c=e[d].endPos;if(!(f>n||i>c)){var u=c-a+1;t.fillRect((a-i)*r,h,u*r,s)}}},ASPlot.Utility.prototype.blocksPlotWithLineAS=function(t,e,i,n,o,s,r,h,l,a,c){0!=a&&(t.fillStyle="#000000",t.font="13px monospace",t.fillText(c,0,h+15)),t.fillStyle="#000000",t.font="10px monospace",("undefined"==typeof l||null==l)&&(l="#800000"),("undefined"==typeof h||null==h)&&(s=20);var u=-1,d=-1,f=-1;t.strokeStyle="#000000",t.lineWidth=2;for(var p in e){t.fillStyle=l;var P=e[p].ifAS,m=e[p].begPos,u=m>i?m:i,d=i>d?i:d;0!=p&&(o>a+(d-i+1)*r&&(t.moveTo(a+(d-i+1)*r,h+s/2),a+(d-i+(u-d)/2)*r>o?t.lineTo(o,h):t.lineTo(a+(d-i+(u-d)/2)*r,h)),o>a+(d-i+(u-d)/2)*r&&(t.moveTo(a+(d-i+(u-d)/2)*r,h),a+(u-i)*r>o?t.lineTo(o,h+s/2):t.lineTo(a+(u-i)*r,h+s/2)));var d=e[p].endPos;if(!(m>n||i>d)){var f=d-u+1;P?t.fillStyle="#FA8072":t.fillStyle="#800000",t.fillRect(a+(u-i)*r,h,f*r,s)}}},ASPlot.visualPage=function(t){if("undefined"!=typeof t&&null!=t&&""!=t){var e=new ASPlot.xmlParser;this.plotEngine=new ASPlot.Utility,this.xml=e.parseXML(t),this.genePlot=new ASPlot.GenePlot(e,this.plotEngine),this.isoforms=e.parseIsoforms();this.leftFont="10px monospace",null!=this.isoforms[0]&&(this.proteinPlot1=new ASPlot.ProteinPlot("proteinVisual1",this.isoforms[0],this.isoforms[1],e,this.plotEngine,!1)),this.transcriptPlot=new ASPlot.transcriptPlot(e,this.plotEngine)}},ASPlot.visualPage.prototype.setIfPlotLeft=function(t){this.genePlot.plotLeft=t,this.proteinPlot1.plotLeft=t},ASPlot.ProteinPlot=function(t,e,i,n,o,s){if("undefined"!=typeof t&&null!=t&&""!=t){this.plotLeft=!0,this.leftWidth=120,this.isoform1=e,this.isoform2=i,this.strand=n.getStrand(),this.proteinLength=e.proteinSequence.length,this.start=1,this.end=this.proteinLength,this.plotEngine=o,this.canvasProtein=document.getElementById(t),this.contextProtein=this.canvasProtein.getContext("2d"),this.canvasProteinWidth=this.canvasProtein.width,this.currentPosition=0,this.x=-1,this.y=-1,this.mouseIsDown=!1,this.moveWidth=10,this.coordinatePosition=-1,this.ifASOut=s,this.browserName=getBrowserName(),this.unitWidth=11,this.maxUnitWidth=15,this.minUnitWidth=1,this.minFontWidth=7,this.imgData,this.moveLastX=-1,this.moveLastY=-1,this.geneStrucBlocks=n.parseTranscript(),this.currentPosition=this.start,this.residue=0;var r=this;if(this.alternativeSplicingRegions=[],this.canvasProtein.addEventListener("mouseup",function(t){r.mouseUp(t)},!1),this.canvasProtein.addEventListener("mousedown",function(t){r.mouseDown(t)},!1),this.canvasProtein.addEventListener("mousemove",function(t){r.mouseMove(t)},!1),this.canvasProtein.addEventListener("keydown",function(t){r.keyDown(t)},!1),this.canvasProtein.addEventListener("mouseout",function(t){r.mouseOut(t)},!1),"Firefox"==this.browserName?this.canvasProtein.addEventListener("DOMMouseScroll",function(t){r.mouseWheel(t)},!1):this.canvasProtein.addEventListener("mousewheel",function(t){r.mouseWheel(t)},!1),"POSITIVE"==this.strand||(this.geneStrucBlocks=this.geneStrucBlocks.reverse()),this.canvasProtein.height="400","undefined"==typeof this.isoform2||null!=this.isofrom2)return this.canvasProtein.height="450",null;for(var h=0,l=-1,a=-1,c=0;c<this.geneStrucBlocks.length;c++){var u=this.geneStrucBlocks[c].begPos,d=this.geneStrucBlocks[c].endPos,f=this.geneStrucBlocks[c].ifAS,p=(d-u+1)/3;f&&(-1!=l&&a!=h?a=Math.floor(h+p):(-1!=l&&this.alternativeSplicingRegions.push({begPos:l,endPos:a}),l=Math.floor(h),a=Math.floor(h+p))),h+=p}-1!=l&&this.alternativeSplicingRegions.push({begPos:l,endPos:a});for(var P=0;P<this.alternativeSplicingRegions.length;++P){for(var m=this.alternativeSplicingRegions[P].begPos,v=this.alternativeSplicingRegions[P].endPos,g=Math.floor(v-m),y=this.isoform2.pfams.length,x=0;y>x;++x){var S=this.isoform2.pfams[x],W=S.begPos,A=S.endPos;m>W&&A>m?(this.isoform2.pfams[x].endPos=m,W=v,A+=g,this.isoform2.pfams.push({begPos:W,endPos:A,description:S.description,pfamFamily:S.pfamFamily})):(W>m&&(this.isoform2.pfams[x].begPos=W+g),A>m&&(this.isoform2.pfams[x].endPos=A+g))}for(var x=0;g>x;++x)this.isoform2.disorderValue.splice(m,0,0);this.start,i.proteinSequence.substring(0,m);for(var b="",x=0;g>x;++x)b+=" ";this.isoform2.polarity=this.isoform2.polarity.substring(0,m)+b+this.isoform2.polarity.substring(m,this.isoform2.polarity.length),this.isoform2.charge=this.isoform2.charge.substring(0,m)+b+this.isoform2.charge.substring(m,this.isoform2.charge.length),this.isoform2.proteinSequence=this.isoform2.proteinSequence.substring(0,m)+b+this.isoform2.proteinSequence.substring(m,this.isoform2.proteinSequence.length)}}},ASPlot.ProteinPlot.prototype.mouseDown=function(t){this.mouseIsDown=!0;var e=getOffset(t);this.x=e.x,this.y=e.y},ASPlot.ProteinPlot.prototype.mouseWheel=function(t){var e=t.wheelDelta;"Firefox"==this.browserName&&(e=t.detail);t.shiftKey;0>e?(this.unitWidth--,this.unitWidth<this.minUnitWidth&&(this.unitWidth=this.minUnitWidth)):(this.unitWidth++,this.unitWidth>this.maxUnitWidth&&(this.unitWidth=this.maxUnitWidth));var i=this.end-Math.round((this.canvasProteinWidth-this.leftWidth)/this.unitWidth)+13;0>i&&(i=0),this.currentPosition>i&&(this.currentPosition=i),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot(),event.preventDefault(),event.returnValue=!1},ASPlot.ProteinPlot.prototype.mouseOut=function(t){this.mouseIsDown=!1},ASPlot.ProteinPlot.prototype.mouseUp=function(t){this.mouseIsDown=!1},ASPlot.ProteinPlot.prototype.mouseMove=function(t){var e=getOffset(t),i=e.x,n=e.y;if(this.mouseIsDown&&Math.abs(i-this.x)>this.moveWidth){var o=i-this.x+this.residue;this.residue=o%this.unitWidth,this.currentPosition=this.currentPosition+parseInt(-1*o/this.unitWidth);var s=this.end-Math.round((this.canvasProteinWidth-this.leftWidth)/this.unitWidth)+13;0>s&&(s=0),this.currentPosition>s&&(this.currentPosition=s),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot(),this.x=i,this.y=n}else(Math.abs(i-this.moveLastX)>this.moveWidth/2||Math.abs(n-this.moveLastY)>this.moveWidth/2)&&(this.contextProtein.beginPath(),this.contextProtein.strokeStyle="#000000",this.contextProtein.lineWidth=2,this.contextProtein.putImageData(this.imgData,0,0),this.imgData=this.contextProtein.getImageData(0,0,this.canvasProtein.width,this.canvasProtein.height),this.contextProtein.moveTo(0,n),this.contextProtein.lineTo(this.canvasProteinWidth,n),this.contextProtein.moveTo(i,0),this.contextProtein.lineTo(i,this.canvasProtein.height),this.contextProtein.stroke(),this.moveLastX=i,this.moveLastY=n)},ASPlot.ProteinPlot.prototype.keyDown=function(t){39==t.keyCode&&(this.currentPosition+=1),37==t.keyCode&&(this.currentPosition+=-1);var e=this.end-Math.round((this.canvasProtein.width-this.leftWidth)/this.unitWidth)+13;0>e&&(e=0),this.currentPosition>e&&(this.currentPosition=e),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot()},ASPlot.ProteinPlot.prototype.plot=function(){this.contextProtein.beginPath(),this.contextProtein.clearRect(0,0,this.canvasProtein.width,this.canvasProtein.height);var t=30;"undefined"!=typeof this.isoform2&&null!=this.isoform2&&(t+=this.disPlot(t,this.isoform2),t+=this.pfamPlot(t,this.isoform2),t+=this.plotAlphabet(t,this.isoform2),t+=this.plotCharge(t,this.isoform2),t+=this.plotPolarity(t,this.isoform2),t+=this.plotProteinBlocks(t,!0)),this.coordinatePosition=t,t+=this.plotCoordinate(t),t+=this.plotProteinBlocks(t,"undefined"==typeof this.isoform2?!0:!1),t+=this.plotPolarity(t,this.isoform1),t+=this.plotCharge(t,this.isoform1),t+=this.plotAlphabet(t,this.isoform1),t+=this.pfamPlot(t,this.isoform1),t+=this.asaPlot(t,this.isoform1),t+=this.alpha_helixPlot(t,this.isoform1),t+=this.beta_sheetPlot(t,this.isoform1),t+=this.random_coilPlot(t,this.isoform1),t+=this.disPlot(t,this.isoform1),t+=this.ptmPlot(t,this.isoform1),this.plotDecoration(),this.contextProtein.stroke(),this.imgData=this.contextProtein.getImageData(0,0,this.canvasProtein.width,this.canvasProtein.height)},ASPlot.ProteinPlot.prototype.plotDecoration=function(){this.contextProtein.fillStyle="#000000","undefined"!=typeof this.isoform2&&null!=this.isoform2&&(this.contextProtein.moveTo(this.leftWidth-20,15),this.contextProtein.lineTo(this.leftWidth-10,10),this.contextProtein.moveTo(this.leftWidth-10,10),this.contextProtein.lineTo(this.leftWidth,15),this.contextProtein.moveTo(this.leftWidth-10,10),this.contextProtein.lineTo(this.leftWidth-10,this.coordinatePosition-5),this.contextProtein.moveTo(this.leftWidth-20,this.coordinatePosition-10),this.contextProtein.lineTo(this.leftWidth-10,this.coordinatePosition-5),this.contextProtein.moveTo(this.leftWidth-10,this.coordinatePosition-5),this.contextProtein.lineTo(this.leftWidth,this.coordinatePosition-10),this.contextProtein.save(),this.contextProtein.translate(0,0),this.contextProtein.rotate(-Math.PI/2),this.contextProtein.fillText("AS isoform",10-this.coordinatePosition,this.leftWidth-25),this.contextProtein.fillText("Canonical isoform",100-this.canvasProtein.height,this.leftWidth-20),this.contextProtein.restore()),this.contextProtein.moveTo(this.leftWidth-20,this.coordinatePosition+30),this.contextProtein.lineTo(this.leftWidth-10,this.coordinatePosition+20),this.contextProtein.moveTo(this.leftWidth-10,this.coordinatePosition+20),this.contextProtein.lineTo(this.leftWidth,this.coordinatePosition+30),this.contextProtein.moveTo(this.leftWidth-10,this.coordinatePosition+20),this.contextProtein.lineTo(this.leftWidth-10,this.canvasProtein.height-10),this.contextProtein.moveTo(this.leftWidth-20,this.canvasProtein.height-15),this.contextProtein.lineTo(this.leftWidth-10,this.canvasProtein.height-10),this.contextProtein.moveTo(this.leftWidth-10,this.canvasProtein.height-10),this.contextProtein.lineTo(this.leftWidth,this.canvasProtein.height-15)},ASPlot.ProteinPlot.prototype.plotAlphabet=function(t,e){if(this.unitWidth<this.minFontWidth)return 0;var i=e.proteinSequence.substring(this.currentPosition-this.start,e.proteinSequence.length),n=this.currentPosition+this.canvasProteinWidth/this.unitWidth;return this.plotEngine.alphabetPlot(this.contextProtein,i,this.currentPosition,n,this.unitWidth,t,this.leftWidth,"amino acid"),35},ASPlot.ProteinPlot.prototype.plotPolarity=function(t,e){if(this.unitWidth<this.minFontWidth)return 0;var i=e.polarity.substring(this.currentPosition-this.start,e.polarity.length),n=this.currentPosition+this.canvasProteinWidth/this.unitWidth;return this.plotEngine.alphabetPlotColorTable(this.contextProtein,i,this.currentPosition,n,this.unitWidth,t,this.leftWidth,"polarity"),35},ASPlot.ProteinPlot.prototype.plotCharge=function(t,e){if(this.unitWidth<this.minFontWidth)return 0;var i=e.charge.substring(this.currentPosition-this.start,e.charge.length),n=this.currentPosition+this.canvasProteinWidth/this.unitWidth;return this.plotEngine.alphabetPlotColorTable(this.contextProtein,i,this.currentPosition,n,this.unitWidth,t,this.leftWidth,"charge"),35},ASPlot.ProteinPlot.prototype.plotCoordinate=function(t){var e=this.currentPosition+this.canvasProteinWidth/this.unitWidth;return this.plotEngine.coordinatePlotAS(this.contextProtein,this.alternativeSplicingRegions,this.currentPosition,e,this.canvasProteinWidth,50,this.unitWidth,t,"#aa66aa",this.leftWidth,"coordinate"),35},ASPlot.ProteinPlot.prototype.plotProteinBlocks=function(t,e){var i=this.unitWidth/3,n=3*(this.currentPosition-1),o=Math.floor(n+this.canvasProteinWidth/i);0!=this.leftWidth&&(this.contextProtein.fillStyle="#000000",this.contextProtein.font="13px monospace",this.contextProtein.fillText("exons",0,t+15)),this.contextProtein.fillStyle="#800000",this.contextProtein.font="10px monospace",("undefined"==typeof color||null==color)&&(color="#800000"),("undefined"==typeof height||null==height)&&(rowHeight=20),this.contextProtein.fillStyle=color;var s=0;color="#800000",this.contextProtein.fillStyle=color;for(var r=0;r<this.geneStrucBlocks.length;r++){var h=this.geneStrucBlocks[r].begPos,l=this.geneStrucBlocks[r].endPos,a=this.geneStrucBlocks[r].ifAS;if(!this.ifASOut||!a){var c=l-h+1,u=s+1,d=u+c-1;if(s+=c,!(n>d||u>o)){u=u>n?u:n,d=o>d?d:o;var f=d-u+1;a&&e?this.contextProtein.fillStyle="#FA8072":this.contextProtein.fillStyle="#800000",console.log("Plotein bloks plot,boxBegPos: "+h+" 	boxEndPos: "+l+"	 beg: "+u+"	end: "+d+"	length:"+f+"	curNucleotidePos: "+n),this.contextProtein.fillRect(this.leftWidth+(u-n)*i,t,f*i,20)}}}return 35},ASPlot.ProteinPlot.prototype.pfamPlot=function(t,e){var i=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=e.pfams,o=this.plotEngine.blocksPlotPipeLine(this.contextProtein,n,this.currentPosition,i,this.canvasProteinWidth,20,this.unitWidth,t,"#808000",this.leftWidth,"pfam");return o},ASPlot.ProteinPlot.prototype.ptmPlot=function(t,e){var i=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=e.ptms,o=this.plotEngine.pointPlot(this.contextProtein,n,this.currentPosition,i,this.canvasProteinWidth,20,this.unitWidth,t,"#808000",this.leftWidth,"ptm");return o},ASPlot.ProteinPlot.prototype.disPlot=function(t,e){var i=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=e.disorderValue;return this.plotEngine.continuousValuePlot(this.contextProtein,n,this.currentPosition,i,this.unitWidth,t,this.leftWidth,"disprot"),35},ASPlot.ProteinPlot.prototype.asaPlot=function(t,e){var i=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=e.asaValue;return this.plotEngine.continuousValuePlot(this.contextProtein,n,this.currentPosition,i,this.unitWidth,t,this.leftWidth,"asa"),35},ASPlot.ProteinPlot.prototype.random_coilPlot=function(t,e){var i=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=e.random_coilValue;return this.plotEngine.continuousValuePlot(this.contextProtein,n,this.currentPosition,i,this.unitWidth,t,this.leftWidth,"random_coil"),35},ASPlot.ProteinPlot.prototype.beta_sheetPlot=function(t,e){var i=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=e.beta_sheetValue;return this.plotEngine.continuousValuePlot(this.contextProtein,n,this.currentPosition,i,this.unitWidth,t,this.leftWidth,"beta_sheet"),35},ASPlot.ProteinPlot.prototype.alpha_helixPlot=function(t,e){var i=this.currentPosition+this.canvasProteinWidth/this.unitWidth,n=e.alpha_helixValue;return this.plotEngine.continuousValuePlot(this.contextProtein,n,this.currentPosition,i,this.unitWidth,t,this.leftWidth,"alpha_helix"),35},ASPlot.GenePlot=function(t,e){this.plotLeft=!0,this.leftWidth=120,this.plotEngine=e,this.canvasGene=document.getElementById("geneVisual"),this.contextGene=this.canvasGene.getContext("2d"),this.canvasGeneWidth=this.canvasGene.width,this.strand=t.getStrand(),this.currentPosition=-1,this.unitwidth=-1,this.x=-1,this.y=-1,this.mouseIsDown=!1,this.moveWidth=15,this.imgData,this.moveLastX=-1,this.moveLastY=-1,this.unitWidth=11,this.maxUnitWidth=15,this.minUnitWidth=.01,this.minFontWidth=7,this.residue=0;var i=t.parseGeneSequence();this.conservation=t.parseConservationScore(),this.geneSequence=i.sequence,this.start=parseInt(i.start),this.end=parseInt(i.end),this.geneStrucBlocks=t.parseASExons(),this.currentPosition=this.start,this.browserName=getBrowserName();var n=this,o=document.getElementById("gotoposition");o.addEventListener("click",function(){var t=document.getElementById("coordiantePosition");console.log(t.value),n.go(t.value)},!1),this.canvasGene.addEventListener("mouseup",function(t){n.mouseUp(t)},!1),this.canvasGene.addEventListener("mousedown",function(t){n.mouseDown(t)},!1),this.canvasGene.addEventListener("mousemove",function(t){n.mouseMove(t)},!1),this.canvasGene.addEventListener("keydown",function(t){n.keyDown(t)},!1),this.canvasGene.addEventListener("mouseout",function(t){n.mouseOut(t)},!1),"Firefox"==this.browserName?this.canvasGene.addEventListener("DOMMouseScroll",function(t){n.mouseWheel(t)},!1):this.canvasGene.addEventListener("mousewheel",function(t){n.mouseWheel(t)},!1)},ASPlot.GenePlot.prototype.mouseDown=function(t){this.mouseIsDown=!0,this.x=t.clientX,this.y=t.clientY},ASPlot.GenePlot.prototype.mouseWheel=function(t){var e=t.wheelDelta;"Firefox"==this.browserName&&(e=t.detail);t.shiftKey;0>e?(this.unitWidth<=1?this.unitWidth=this.unitWidth/1.2:this.unitWidth--,this.unitWidth<this.minUnitWidth&&(this.unitWidth=this.minUnitWidth)):(this.unitWidth<=1?this.unitWidth=1.2*this.unitWidth:this.unitWidth++,this.unitWidth>this.maxUnitWidth&&(this.unitWidth=this.maxUnitWidth));var i=this.end-Math.round((this.canvasGeneWidth-this.leftWidth)/this.unitWidth)+13;0>i&&(i=0),this.currentPosition>i&&(this.currentPosition=i),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot(),event.preventDefault(),event.returnValue=!1},ASPlot.GenePlot.prototype.mouseOut=function(t){this.mouseIsDown=!1},ASPlot.GenePlot.prototype.mouseUp=function(t){this.mouseIsDown=!1},ASPlot.GenePlot.prototype.go=function(t){this.currentPosition=parseInt(t),this.plot()},ASPlot.GenePlot.prototype.mouseMove=function(t){var e=void 0==t.offsetX?t.layerX:t.offsetX,i=void 0==t.offsetY?t.layerY:t.offsetY;if(this.mouseIsDown&&Math.abs(e-this.x)>this.moveWidth){document.body.style.cursor="default";var n=e-this.x+this.residue;this.residue=n%this.unitWidth,this.currentPosition=this.currentPosition+parseInt(-1*n/this.unitWidth);var o=this.end-Math.round((this.canvasGeneWidth-this.leftWidth)/this.unitWidth)+13;0>o&&(o=0),this.currentPosition>o&&(this.currentPosition=o),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot(),this.x=e,this.y=i}else Math.abs(e-this.moveLastX)>this.moveWidth/2&&(this.contextGene.beginPath(),this.contextGene.strokeStyle="#000000",this.contextGene.lineWidth=1,this.contextGene.putImageData(this.imgData,0,0),this.imgData=this.contextGene.getImageData(0,0,this.canvasGene.width,this.canvasGene.height),this.contextGene.moveTo(0,i),this.contextGene.lineTo(this.canvasGeneWidth,i),this.contextGene.moveTo(e,0),this.contextGene.lineTo(e,this.canvasGene.height),this.contextGene.stroke(),this.moveLastX=e)},ASPlot.GenePlot.prototype.moveLeft=function(){this.currentPosition-=1,this.plot()},ASPlot.GenePlot.prototype.moveRight=function(){this.currentPosition+=1,this.plot()},ASPlot.GenePlot.prototype.keyDown=function(t){console.log(2),37==t.keyCode&&(this.currentPosition+=1),39==t.keyCode&&(this.currentPosition+=-1);var e=this.end-Math.round((this.canvasGeneWidth-this.leftWidth)/this.unitWidth)+13;0>e&&(e=0),this.currentPosition>e&&(this.currentPosition=e),this.currentPosition<this.start&&(this.currentPosition=this.start),this.plot()},ASPlot.GenePlot.prototype.plot=function(){this.contextGene.beginPath(),this.contextGene.clearRect(0,0,this.canvasGene.width,this.canvasGene.height);var t=20;t+=this.plotCoordinate(t),t+=this.plotAlphabet(t),t+=this.plotGeneBlocks(t),t+=this.plotConservation(t),t+=this.plotStrand(t),this.contextGene.stroke(),this.imgData=this.contextGene.getImageData(0,0,this.canvasGene.width,this.canvasGene.height)},ASPlot.GenePlot.prototype.plotAlphabet=function(t){if(this.unitWidth<this.minFontWidth)return 0;var e=this.geneSequence.substring(this.currentPosition-this.start,this.geneSequence.length),i=this.currentPosition+parseInt(this.canvasGeneWidth/this.unitWidth);return this.plotEngine.alphabetPlot(this.contextGene,e,this.currentPosition,i,this.unitWidth,t,this.leftWidth,"DNA"),35},ASPlot.GenePlot.prototype.plotCoordinate=function(t){var e=this.currentPosition+parseInt(this.canvasGeneWidth/this.unitWidth);return this.plotEngine.coordinatePlot(this.contextGene,this.data,this.currentPosition,e,this.canvasGeneWidth,30,this.unitWidth,t,"#000000",this.leftWidth,"coordinate"),35},ASPlot.GenePlot.prototype.plotGeneBlocks=function(t){var e=this.currentPosition+this.canvasGeneWidth/this.unitWidth;return this.plotEngine.blocksPlotWithLineAS(this.contextGene,this.geneStrucBlocks,this.currentPosition,e,this.canvasGeneWidth,20,this.unitWidth,t,"#800000",this.leftWidth,"geneExons"),35},ASPlot.GenePlot.prototype.plotKnownAlt=function(t){var e=this.currentPosition+this.canvasGeneWidth/this.unitWidth;return this.plotEngine.blocksPlot(this.contextGene,this.knownAlt,this.currentPosition,e,this.canvasGeneWidth,20,this.unitWidth,t,"#FA8072",this.leftWidth,"knowAltUCSC"),35},ASPlot.GenePlot.prototype.plotConservation=function(t){var e=this.currentPosition+this.canvasGeneWidth/this.unitWidth;return this.plotEngine.continuousValuePlot(this.contextGene,this.conservation,this.currentPosition-this.start,e-this.start,this.unitWidth,t,this.leftWidth,"phastCons100way"),35},ASPlot.GenePlot.prototype.plotStrand=function(t){return this.plotEngine.plotStrand(this.contextGene,this.leftWidth,this.canvasGeneWidth,t,"strand",this.strand),35},ASPlot.transcriptPlot=function(t,e){this.leftWidth=200,this.xmlParser=t,this.plotEngine=e,this.canvas2=document.getElementById("transcriptsVisual"),this.context2=this.canvas2.getContext("2d"),this.transcripts=this.xmlParser.parseTranscripts(),this.canvas2.height=30*this.transcripts.length+60},ASPlot.transcriptPlot.prototype.plotAS=function(){this.context1.beginPath();var t=parseInt(this.data[0].begPos),e=parseInt(this.data[this.data.length-1].endPos),i=this.canvas1.width,n=(i-this.leftWidth)/(e-t+1);this.plotEngine.coordinatePlot(this.context1,this.data,t,e,i,50,n,10,"#aa66aa",this.leftWidth),this.plotEngine.blocksPlotWithLineAS(this.context1,this.data,t,e,i,50,n,30,"#aa66aa"),this.context1.stroke()},ASPlot.transcriptPlot.prototype.plot=function(){if(null!=this.transcripts&&0!=this.transcripts.length){this.context2.beginPath();var t=1e9,e=-1;for(var i in this.transcripts){var n=this.transcripts[i].blocks;for(var o in n){var s=parseInt(n[o].begPos),r=parseInt(n[o].endPos);t>s&&(t=s),r>e&&(e=r)}}var h=this.canvas2.width,l=(h-this.leftWidth)/(e-t+1),a=30;this.plotEngine.coordinatePlot(this.context2,this.transcripts,t,e,h,30,l,a,"#aa66aa",this.leftWidth,"coordinate"),a+=30;for(var c=0;c<this.transcripts.length;c++)this.plotEngine.blocksPlotWithLineAS(this.context2,this.transcripts[c].blocks,t,e,h,20,l,a,"#aa66aa",this.leftWidth,this.transcripts[c].ID),a+=25;this.context2.stroke()}},ASPlot.xmlParser=function(){},ASPlot.xmlParser.prototype.parseConservationScore=function(){var t=this.eventNodes[0].getElementsByTagName("conservation"),e=(null==t[0].innerHTML?t[0].textContent:t[0].innerHTML).split(" ");return e},ASPlot.xmlParser.prototype.parseKnownAlt=function(){for(var t=[],e=this.eventNodes[0].getElementsByTagName("ucscaltevent"),i=e[0].childNodes,n=0;n<i.length;++n){var o=parseInt(i[n].getAttribute("start")),s=parseInt(i[n].getAttribute("end"));t.push({begPos:o,endPos:s})}return t},ASPlot.xmlParser.prototype.parseASExons=function(){this.blocks=[];for(var t=this.eventNodes[0].getElementsByTagName("alternativeExons"),e=t[0].childNodes,i=0;i<e.length;++i){var n=parseInt(e[i].getAttribute("start")),o=parseInt(e[i].getAttribute("end")),s=e[i].getAttribute("IfAlternative"),r=Boolean("true"==s);this.blocks.push({begPos:n,endPos:o,ifAS:r})}return this.blocks},ASPlot.xmlParser.prototype.parseTranscript=function(){this.blocks=[];for(var t=this.eventNodes[0].getElementsByTagName("transcript"),e=t[0].childNodes,i=0,n=0;n<e.length;++n){var o=parseInt(e[n].getAttribute("cds_start")),s=parseInt(e[n].getAttribute("cds_end")),r=e[n].getAttribute("strand");if(-1!=o&&-1!=s){"NEGATIVE"===r&&0==i&&(o+=3);var h=e[n].getAttribute("IfAlternative"),l=Boolean("true"==h);this.blocks.push({begPos:o,endPos:s,ifAS:l}),i++}}return"POSITIVE"===r&&n==e.length-1&&(this.blocks[this.blocks.length-1].endPos=this.blocks[this.blocks.length-1].endPos-3),this.blocks},ASPlot.IsoformStruct=function(){this.proteinSequence="",this.pfams,this.disorderString=""},ASPlot.IsoformStruct.prototype.setProteinSequence=function(t){this.proteinSequence=t},ASPlot.xmlParser.prototype.parseIsoforms=function(){for(var t=this.eventNodes[0].getElementsByTagName("isoform"),e=new Array,i=0;i<t.length;i++){var n=(t[i].children,new ASPlot.IsoformStruct),o=null==t[i].getElementsByTagName("proteinSequence")[0].innerHTML?t[i].getElementsByTagName("proteinSequence")[0].textContent:t[i].getElementsByTagName("proteinSequence")[0].innerHTML;n.proteinSequence=o;for(var s=t[i].getElementsByTagName("pfam_domain"),r=[],h=0;h<s.length;h++){var l=parseInt(s[h].getAttribute("start")),a=parseInt(s[h].getAttribute("end")),c=s[h].getAttribute("description"),u=s[h].getAttribute("family");
r.push({begPos:l,endPos:a,description:c,pfamFamily:u})}n.pfams=r;for(var d=t[i].getElementsByTagName("ptm"),f=[],p=0;p<d.length;p++){var P=parseInt(d[p].getAttribute("start")),m=d[p].getAttribute("modification");f.push({begPos:P,endPos:P,description:m})}n.ptms=f;var v=t[i].getElementsByTagName("disProt_value")[0],g=v.getAttribute("disOrder_string"),y=(null==v.innerHTML?v.textContent:v.innerHTML).split(" ");n.disorderValue=y,n.disorderString=g;var x=t[i].getElementsByTagName("asa")[0],S=(null==x.innerHTML?x.textContent:x.innerHTML).split(" ");n.asaValue=S;var W=t[i].getElementsByTagName("random_coil")[0],A=(null==W.innerHTML?W.textContent:W.innerHTML).split(" ");n.random_coilValue=A;var b=t[i].getElementsByTagName("beta_sheet")[0],T=(null==b.innerHTML?b.textContent:b.innerHTML).split(" ");n.beta_sheetValue=T;var E=t[i].getElementsByTagName("alpha_helix")[0],w=(null==E.innerHTML?E.textContent:E.innerHTML).split(" ");n.alpha_helixValue=w;var I=new Object;I.A="n",I.R="b",I.N="p",I.D="p",I.C="n",I.E="a",I.Q="p",I.G="n",I.H="b",I.I="b",I.L="n",I.K="b",I.M="n",I.F="n",I.P="n",I.S="p",I.T="p",I.W="n",I.X="n",I.Y="p",I.V="n";var G=new Object;G.A="n",G.R="p",G.N="n",G.D="g",G.C="n",G.E="g",G.Q="n",G.G="n",G.H="n",G.I="n",G.L="n",G.K="p",G.M="n",G.F="n",G.P="n",G.S="n",G.T="n",G.W="n",G.X="n",G.Y="n",G.V="n",n.polarity="",n.charge="";for(var k=0;k<n.proteinSequence.length;++k)n.polarity+=I[n.proteinSequence[k]],n.charge+=G[n.proteinSequence[k]];e.push(n)}return e},ASPlot.xmlParser.prototype.parseGeneSequence=function(){var t=this.eventNodes[0].getElementsByTagName("geneSequence"),e=null==t[0].innerHTML?t[0].textContent:t[0].innerHTML,i=t[0].getAttribute("start"),n=t[0].getAttribute("end");return{sequence:e,start:i,end:n}},ASPlot.xmlParser.prototype.parseTranscripts=function(){this.transcirpts=[];for(var t=this.eventNodes[0].getElementsByTagName("transcript"),e=0;e<t.length;e++){for(var i=[],n=t[e].childNodes,o=t[e].getAttribute("ID"),s=0;s<n.length;++s){var r=parseInt(n[s].getAttribute("strand")),h=parseInt(n[s].getAttribute("start"));"NEGATIVE"==r&&0==s&&(h+=3);var l=parseInt(n[s].getAttribute("end"));(r=s==n.length-1)&&(l-=3);var a=Boolean("true"==n[s].getAttribute("IfAlternative"));i.push({begPos:h,endPos:l,ifAS:a})}this.transcirpts.push({ID:o,blocks:i})}return this.transcirpts},ASPlot.xmlParser.prototype.getStrand=function(){var t=this.eventNodes[0].getElementsByTagName("strand");return null==t[0].innerHTML?t[0].textContent:t[0].innerHTML},ASPlot.xmlParser.prototype.parseXML=function(t){return window.XMLHttpRequest?xmlHttp=new XMLHttpRequest:xmlHttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlHttp.open("GET",t,!1),xmlHttp.send(null),this.xmldoc=xmlHttp.responseXML.documentElement,this.eventNodes=this.xmldoc.getElementsByTagName("event"),this},ASPlot.submitQuery=function(){var t=document.getElementById("searchFild").value;if("undefined"!=typeof t&&null!=t&&""!=t){var e=new ASPlot.firstPage(t);e.plotAS(),e.plotTranscript()}};